#!/bin/sh
# Pre-commit hook to run deno fmt on staged files

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json)$')

if [ -z "$STAGED_FILES" ]; then
  exit 0
fi

echo "Running deno fmt on staged files..."

# Run deno fmt on staged files
echo "$STAGED_FILES" | xargs deno fmt

# Check if fmt made any changes
FORMATTED_FILES=$(git diff --name-only $STAGED_FILES)

if [ -n "$FORMATTED_FILES" ]; then
  echo ""
  echo "The following files were formatted:"
  echo "$FORMATTED_FILES"
  echo ""
  echo "Please review the changes and add them to your commit:"
  echo "  git add $FORMATTED_FILES"
  echo "  git commit"
  exit 1
fi

echo "âœ“ All files are properly formatted"
exit 0
